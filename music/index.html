<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>playse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 配置Tailwind主题 -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#31C27C', // QQ音乐绿色
            dark: {
              bg: '#121212',
              card: '#1E1E1E',
              text: '#FFFFFF'
            }
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .music-hover {
        @apply transition-all hover:bg-gray-100 dark:hover:bg-dark-card/80;
      }
      .player-shadow {
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      }
    }
  </style>
</head>

<body class="bg-gray-50 dark:bg-dark-bg text-gray-800 dark:text-dark-text min-h-screen flex flex-col transition-colors duration-300">
  <!-- 顶部导航 -->
  <header class="bg-white dark:bg-dark-card py-4 px-6 shadow-sm sticky top-0 z-30 transition-colors duration-300">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-primary">音乐播放器</h1>
      <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-dark-bg transition-colors">
        <span class="dark:hidden">切换深色</span>
        <span class="hidden dark:inline">切换浅色</span>
      </button>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 container mx-auto px-4 py-8">
    <!-- 音乐列表 -->
    <section class="mb-8">
      <h2 class="text-xl font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">音乐列表</h2>
      <ul id="musicList" class="space-y-1">
        <!-- 音乐项由服务端预设 -->
      </ul>
    </section>
  </main>

  <!-- 底部播放器 -->
  <footer id="musicPlayer" class="bg-white dark:bg-dark-card player-shadow py-3 px-4 fixed bottom-0 left-0 right-0 z-20 transition-colors duration-300">
    <div class="container mx-auto">
      <div class="flex flex-col md:flex-row md:items-center gap-4">
        <!-- 歌曲信息 -->
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <div id="currentCover" class="w-14 h-14 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden flex-shrink-0">
            <div class="w-full h-full flex items-center justify-center bg-primary/10">
              <span class="text-primary text-xl">音</span>
            </div>
          </div>
          <div class="min-w-0">
            <h3 id="currentTitle" class="font-medium truncate">未播放音乐</h3>
            <p id="currentArtist" class="text-sm text-gray-500 dark:text-gray-400 truncate">--</p>
          </div>
        </div>

        <!-- 播放控制 -->
        <div class="flex flex-col items-center gap-2 flex-1 md:flex-2">
          <div class="flex items-center gap-4 md:gap-6">
            <button id="prevBtn" class="p-2 hover:text-primary transition-colors">上一首</button>
            <button id="playPauseBtn" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors">
              播放
            </button>
            <button id="nextBtn" class="p-2 hover:text-primary transition-colors">下一首</button>
          </div>
          
          <div class="w-full flex items-center gap-2">
            <span id="currentTime" class="text-xs min-w-[40px] text-center">00:00</span>
            <div class="relative flex-1 h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
              <div id="progressBar" class="absolute left-0 top-0 h-full bg-primary w-0 transition-all"></div>
              <input type="range" id="progressInput" min="0" max="100" value="0" 
                     class="absolute left-0 top-0 w-full h-full opacity-0 cursor-pointer">
            </div>
            <span id="totalTime" class="text-xs min-w-[40px] text-center">00:00</span>
          </div>
        </div>

        <!-- 音量控制 -->
        <div class="flex items-center gap-3 flex-1 justify-end">
          <button id="volumeBtn" class="p-2 hover:text-primary transition-colors">音量</button>
          <div class="w-24 hidden sm:block">
            <input type="range" id="volumeInput" min="0" max="100" value="80" 
                   class="w-full accent-primary">
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // 全局变量
    const audio = new Audio();
    let musicList = [];
    let currentIndex = -1;
    let isPlaying = false;

    // DOM元素
    const elements = {
      musicList: document.getElementById('musicList'),
      themeToggle: document.getElementById('themeToggle'),
      playPauseBtn: document.getElementById('playPauseBtn'),
      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      progressBar: document.getElementById('progressBar'),
      progressInput: document.getElementById('progressInput'),
      currentTime: document.getElementById('currentTime'),
      totalTime: document.getElementById('totalTime'),
      currentTitle: document.getElementById('currentTitle'),
      currentArtist: document.getElementById('currentArtist'),
      volumeBtn: document.getElementById('volumeBtn'),
      volumeInput: document.getElementById('volumeInput')
    };

    // 初始化：从服务端预设音乐列表（仅含"未命名"音乐）
    function initMusicList() {
      // 服务端预设的音乐数据（仅包含"未命名"音乐）
      musicList = [
        {
          id: 1,
          name: "逐梦之光",
          artist: "eric",
          url: "https://dgnse.github.io/music/逐梦之光.mp3" // 这里需要填写实际音乐地址
        }
      ];

      // 渲染音乐列表
      renderMusicList();
      
      // 从localStorage恢复播放状态
      loadPlayState();
    }

    // 渲染音乐列表
    function renderMusicList() {
      elements.musicList.innerHTML = '';
      
      musicList.forEach((music, index) => {
        const li = document.createElement('li');
        li.className = `px-4 py-3 flex justify-between items-center music-hover rounded-md ${currentIndex === index ? 'bg-primary/10' : ''}`;
        li.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="w-6 text-center ${currentIndex === index ? 'text-primary' : 'text-gray-400'}">${index + 1}</span>
            <div>
              <h3 class="font-medium">${music.name}</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">${music.artist}</p>
            </div>
          </div>
          <button class="play-btn p-2 hover:text-primary transition-colors" data-index="${index}">
            ${currentIndex === index && isPlaying ? '暂停' : '播放'}
          </button>
        `;
        elements.musicList.appendChild(li);
        
        // 添加播放事件
        li.querySelector('.play-btn').addEventListener('click', () => playMusic(index));
        // 点击整行播放
        li.addEventListener('click', (e) => {
          if (!e.target.closest('.play-btn')) {
            playMusic(index);
          }
        });
      });
    }

    // 播放音乐
    function playMusic(index) {
      if (index === currentIndex && isPlaying) {
        // 暂停当前播放
        pauseMusic();
        return;
      }

      // 切换音乐
      currentIndex = index;
      const music = musicList[index];
      audio.src = music.url;
      
      // 更新UI
      elements.currentTitle.textContent = music.name;
      elements.currentArtist.textContent = music.artist;
      elements.playPauseBtn.textContent = '暂停';
      
      // 播放
      audio.play().then(() => {
        isPlaying = true;
        renderMusicList();
        savePlayState(); // 保存播放状态到localStorage
      }).catch(err => {
        console.error('播放失败:', err);
        alert('音乐播放失败，请检查网络或音乐地址是否正确');
      });
    }

    // 暂停音乐
    function pauseMusic() {
      audio.pause();
      isPlaying = false;
      elements.playPauseBtn.textContent = '播放';
      renderMusicList();
      savePlayState();
    }

    // 上一首
    function prevMusic() {
      if (musicList.length === 0) return;
      currentIndex = (currentIndex - 1 + musicList.length) % musicList.length;
      playMusic(currentIndex);
    }

    // 下一首
    function nextMusic() {
      if (musicList.length === 0) return;
      currentIndex = (currentIndex + 1) % musicList.length;
      playMusic(currentIndex);
    }

    // 格式化时间（秒 -> mm:ss）
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // 保存播放状态到localStorage
    function savePlayState() {
      const playState = {
        currentIndex,
        isPlaying,
        currentTime: audio.currentTime,
        volume: audio.volume
      };
      localStorage.setItem('musicPlayState', JSON.stringify(playState));
    }

    // 从localStorage加载播放状态
    function loadPlayState() {
      const savedState = localStorage.getItem('musicPlayState');
      if (savedState) {
        const { currentIndex: savedIndex, isPlaying: savedPlaying, currentTime, volume } = JSON.parse(savedState);
        if (savedIndex >= 0 && savedIndex < musicList.length) {
          currentIndex = savedIndex;
          audio.volume = volume || 0.8;
          elements.volumeInput.value = (volume * 100) || 80;
          
          if (savedPlaying) {
            // 恢复播放位置
            audio.addEventListener('loadedmetadata', () => {
              audio.currentTime = currentTime;
              audio.play().then(() => {
                isPlaying = true;
                elements.playPauseBtn.textContent = '暂停';
                renderMusicList();
              }).catch(() => {});
            }, { once: true });
            
            audio.src = musicList[currentIndex].url;
            elements.currentTitle.textContent = musicList[currentIndex].name;
            elements.currentArtist.textContent = musicList[currentIndex].artist;
          }
        }
      }
    }

    // 切换主题
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      // 保存主题偏好到localStorage
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('musicPlayerTheme', isDark ? 'dark' : 'light');
    }

    // 初始化主题
    function initTheme() {
      const savedTheme = localStorage.getItem('musicPlayerTheme');
      if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    }

    // 事件监听
    function setupEventListeners() {
      // 播放/暂停按钮
      elements.playPauseBtn.addEventListener('click', () => {
        if (currentIndex === -1 && musicList.length > 0) {
          playMusic(0); // 没有播放时默认播放第一首
        } else if (isPlaying) {
          pauseMusic();
        } else {
          audio.play();
          isPlaying = true;
          elements.playPauseBtn.textContent = '暂停';
          renderMusicList();
          savePlayState();
        }
      });

      // 上一首/下一首
      elements.prevBtn.addEventListener('click', prevMusic);
      elements.nextBtn.addEventListener('click', nextMusic);

      // 进度条控制
      audio.addEventListener('timeupdate', () => {
        if (!isDragging) {
          const progress = (audio.currentTime / audio.duration) * 100;
          elements.progressBar.style.width = `${progress}%`;
          elements.progressInput.value = progress;
          elements.currentTime.textContent = formatTime(audio.currentTime);
        }
      });

      // 音频加载完成
      audio.addEventListener('loadedmetadata', () => {
        elements.totalTime.textContent = formatTime(audio.duration);
      });

      // 进度条拖动
      let isDragging = false;
      elements.progressInput.addEventListener('input', (e) => {
        isDragging = true;
        const progress = e.target.value;
        elements.progressBar.style.width = `${progress}%`;
      });

      elements.progressInput.addEventListener('change', (e) => {
        isDragging = false;
        const progress = e.target.value / 100;
        audio.currentTime = progress * audio.duration;
        savePlayState();
      });

      // 音量控制
      elements.volumeInput.addEventListener('input', (e) => {
        const volume = e.target.value / 100;
        audio.volume = volume;
        savePlayState();
      });

      // 主题切换
      elements.themeToggle.addEventListener('click', toggleTheme);

      // 音乐结束自动播放下一首
      audio.addEventListener('ended', () => {
        if (currentIndex === musicList.length - 1) {
          // 最后一首结束后重置
          currentIndex = -1;
          isPlaying = false;
          elements.playPauseBtn.textContent = '播放';
          elements.currentTime.textContent = '00:00';
          elements.progressBar.style.width = '0%';
          elements.progressInput.value = 0;
          renderMusicList();
          savePlayState();
        } else {
          nextMusic();
        }
      });
    }

    // 初始化
    function init() {
      initTheme();
      initMusicList();
      setupEventListeners();
    }

    // 启动应用
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
